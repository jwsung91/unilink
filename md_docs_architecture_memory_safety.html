<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>unilink: Memory Safety Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">unilink
   &#160;<span id="projectnumber">0.3.3</span>
   </div>
   <div id="projectbrief">A simple C++ library for unified async communication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_architecture_memory_safety.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Memory Safety Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>unilink</code> provides comprehensive memory safety features to ensure robust and secure applications. This document describes the memory safety architecture, features, and best practices.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md10"></a>
Table of Contents</h1>
<ol type="1">
<li><a href="#overview">Overview</a></li>
<li><a href="#safe-data-handling">Safe Data Handling</a></li>
<li><a href="#thread-safe-state-management">Thread-Safe State Management</a></li>
<li><a href="#memory-tracking">Memory Tracking</a></li>
<li><a href="#addresssanitizer-support">AddressSanitizer Support</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md12"></a>
Overview</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Memory Safety Guarantees</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Performance Impact    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Bounds Checking</b>   </td><td class="markdownTableBodyNone">All buffer access validated   </td><td class="markdownTableBodyNone">Minimal (&lt;1%)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Type Safety</b>   </td><td class="markdownTableBodyNone">Safe conversions prevent UB   </td><td class="markdownTableBodyNone">Zero (compile-time)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Leak Detection</b>   </td><td class="markdownTableBodyNone">Track allocations/deallocations   </td><td class="markdownTableBodyNone">Zero (Release builds)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Thread Safety</b>   </td><td class="markdownTableBodyNone">All state management thread-safe   </td><td class="markdownTableBodyNone">Minimal (~2-5%)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Memory Pools</b>   </td><td class="markdownTableBodyNone">Reduce fragmentation   </td><td class="markdownTableBodyNone">Positive (+30% for small buffers)   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="autotoc_md15"></a>
Safety Levels</h2>
<p><code>unilink</code> provides multiple levels of memory safety:</p>
<div class="fragment"><div class="line">flowchart TD</div>
<div class="line">    L1[Level 1: Compile-Time Safety&lt;br/&gt;- Type safety&lt;br/&gt;- RAII resource management] --&gt; L2</div>
<div class="line">    L2[Level 2: Runtime Safety (Release)&lt;br/&gt;- Bounds checking&lt;br/&gt;- Safe conversions&lt;br/&gt;- Thread synchronization] --&gt; L3</div>
<div class="line">    L3[Level 3: Debug Safety (Debug)&lt;br/&gt;- Memory tracking&lt;br/&gt;- Allocation tracking&lt;br/&gt;- Leak detection] --&gt; L4</div>
<div class="line">    L4[Level 4: Sanitizers (Optional)&lt;br/&gt;- AddressSanitizer&lt;br/&gt;- ThreadSanitizer&lt;br/&gt;- UndefinedBehaviorSanitizer]</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md17"></a>
Safe Data Handling</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
SafeDataBuffer</h2>
<p>Immutable, type-safe buffer wrapper around existing data:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="memory__tracker_8hpp.html">unilink/memory/memory_tracker.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="safe__span_8hpp.html">unilink/memory/safe_span.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="safe__data__buffer_8hpp.html">unilink/memory/safe_data_buffer.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceunilink_1_1common.html">unilink::common</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create from existing data</span></div>
<div class="line">SafeDataBuffer from_vec(std::vector&lt;uint8_t&gt;{1, 2, 3});</div>
<div class="line">SafeDataBuffer from_str(std::string(<span class="stringliteral">&quot;hello&quot;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read access</span></div>
<div class="line"><span class="keyword">auto</span> span = from_vec.as_span();      <span class="comment">// Non-owning view</span></div>
<div class="line"><span class="keyword">auto</span> <span class="keywordtype">byte</span> = from_vec.at(1);          <span class="comment">// Bounds-checked</span></div>
<div class="line"><span class="keyword">auto</span> unchecked = from_vec.data()[0]; <span class="comment">// Pointer access</span></div>
<div class="ttc" id="amemory__tracker_8hpp_html"><div class="ttname"><a href="memory__tracker_8hpp.html">memory_tracker.hpp</a></div></div>
<div class="ttc" id="anamespaceunilink_1_1common_html"><div class="ttname"><a href="namespaceunilink_1_1common.html">unilink::common</a></div><div class="ttdef"><b>Definition:</b> <a href="common_8hpp_source.html#l00186">common.hpp:186</a></div></div>
<div class="ttc" id="asafe__data__buffer_8hpp_html"><div class="ttname"><a href="safe__data__buffer_8hpp.html">safe_data_buffer.hpp</a></div></div>
<div class="ttc" id="asafe__span_8hpp_html"><div class="ttname"><a href="safe__span_8hpp.html">safe_span.hpp</a></div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md20"></a>
Features</h2>
<h3><a class="anchor" id="autotoc_md21"></a>
1. Construction Validation</h3>
<ul>
<li>Rejects null pointers when size &gt; 0</li>
<li>Rejects buffers &gt;100MB</li>
<li>Copies incoming data into owned storage</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md23"></a>
2. Safe Type Conversions</h3>
<p>Utility functions prevent undefined behavior:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="common_8hpp.html">unilink/base/common.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>unilink::common::safe_convert;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Safe uint8_t* to string conversion</span></div>
<div class="line"><span class="keyword">const</span> uint8_t* data = ...;</div>
<div class="line"><span class="keywordtype">size_t</span> size = ...;</div>
<div class="line">std::string str = <a class="code" href="namespaceunilink_1_1base_1_1safe__convert.html#a3c41d9c6266428458c97891710ac2f0d">uint8_to_string</a>(data, size);  <span class="comment">// Null-check included</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Safe string to uint8_t* conversion</span></div>
<div class="line">std::string input = <span class="stringliteral">&quot;Hello&quot;</span>;</div>
<div class="line"><span class="keyword">const</span> uint8_t* bytes = <a class="code" href="namespaceunilink_1_1base_1_1safe__convert.html#a439f562cc86e942edf24d1408bcb8a92">string_to_uint8</a>(input);</div>
<div class="line"><span class="keywordtype">size_t</span> len = input.size();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Safe numeric conversions with bounds checking</span></div>
<div class="line"><span class="keywordtype">int</span> value = safe_cast&lt;int&gt;(long_value);  <span class="comment">// Checks range</span></div>
<div class="ttc" id="acommon_8hpp_html"><div class="ttname"><a href="common_8hpp.html">common.hpp</a></div></div>
<div class="ttc" id="anamespaceunilink_1_1base_1_1safe__convert_html_a3c41d9c6266428458c97891710ac2f0d"><div class="ttname"><a href="namespaceunilink_1_1base_1_1safe__convert.html#a3c41d9c6266428458c97891710ac2f0d">unilink::base::safe_convert::uint8_to_string</a></div><div class="ttdeci">std::string uint8_to_string(const uint8_t *data, size_t size)</div><div class="ttdoc">Safely convert uint8_t* to const char* for string operations.</div><div class="ttdef"><b>Definition:</b> <a href="common_8hpp_source.html#l00143">common.hpp:143</a></div></div>
<div class="ttc" id="anamespaceunilink_1_1base_1_1safe__convert_html_a439f562cc86e942edf24d1408bcb8a92"><div class="ttname"><a href="namespaceunilink_1_1base_1_1safe__convert.html#a439f562cc86e942edf24d1408bcb8a92">unilink::base::safe_convert::string_to_uint8</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; string_to_uint8(const char *data, size_t size)</div><div class="ttdoc">Safely convert const char* to const uint8_t* for binary operations.</div><div class="ttdef"><b>Definition:</b> <a href="common_8hpp_source.html#l00156">common.hpp:156</a></div></div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md25"></a>
3. Memory Validation</h3>
<p>Comprehensive validation of data integrity:</p>
<div class="fragment"><div class="line"><span class="comment">// Validate buffer state</span></div>
<div class="line"><span class="keywordflow">if</span> (buffer.is_valid()) {</div>
<div class="line">    <span class="comment">// Buffer is in consistent state</span></div>
<div class="line">    process_data(buffer.data(), buffer.size());</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Buffer corrupted or uninitialized</span></div>
<div class="line">    handle_error();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Explicit validation (throws on oversize)</span></div>
<div class="line">buffer.validate();</div>
</div><!-- fragment --><p><b>Mutation model:</b> Data is populated at construction; no in-place <code>write/append</code> helpers exist. Use <code>clear()/resize()/reserve()</code> only when you control the backing data size.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md27"></a>
Safe Span (C++17 Compatible)</h2>
<p>Lightweight, non-owning view of contiguous data:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="safe__span_8hpp.html">unilink/memory/safe_span.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceunilink_1_1common.html">unilink::common</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> process_data(safe_span&lt;const uint8_t&gt; data) {</div>
<div class="line">    <span class="comment">// Iteration (operator[] is unchecked)</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; data.size(); i++) {</div>
<div class="line">        uint8_t <span class="keywordtype">byte</span> = data[i];</div>
<div class="line">        process_byte(<span class="keywordtype">byte</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Bounds-checked access</span></div>
<div class="line">    <span class="keyword">auto</span> subset = data.subspan(1, 2);  <span class="comment">// throws on invalid ranges</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Usage</span></div>
<div class="line">std::vector&lt;uint8_t&gt; buffer = {1, 2, 3, 4, 5};</div>
<div class="line">process_data(safe_span&lt;const uint8_t&gt;(buffer));</div>
</div><!-- fragment --><p><b>Features:</b></p>
<ul>
<li>No ownership (lightweight)</li>
<li><code>at()/subspan()</code> are checked; <code>operator[]</code> is unchecked</li>
<li>C++17 compatible (pre-C++20 <code>std::span</code>)</li>
<li>Zero overhead in release builds</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md29"></a>
Thread-Safe State Management</h1>
<h2><a class="anchor" id="autotoc_md30"></a>
ThreadSafeState</h2>
<p>Read-write lock based state management:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="thread__safe__state_8hpp.html">unilink/concurrency/thread_safe_state.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceunilink_1_1common.html">unilink::common</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum class</span> ConnectionState {</div>
<div class="line">    <a class="code" href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca03f4a47830f97377a35321051685071e">Closed</a>,</div>
<div class="line">    <a class="code" href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75cae321c53b354930ba96f0243e652df458">Connecting</a>,</div>
<div class="line">    <a class="code" href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca2ec0d16e4ca169baedb9b2d50ec5c6d7">Connected</a>,</div>
<div class="line">    <a class="code" href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca902b0d55fddef6f8d651fe1035b7d4bd">Error</a></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">ThreadSafeState&lt;ConnectionState&gt; state(ConnectionState::Closed);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 1: Write</span></div>
<div class="line">state.set_state(ConnectionState::Connecting);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 2: Read (concurrent safe)</span></div>
<div class="line">ConnectionState current = state.get_state();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 3: Conditional update</span></div>
<div class="line"><span class="keywordtype">bool</span> updated = state.compare_and_set(</div>
<div class="line">    ConnectionState::Connecting,  <span class="comment">// Expected</span></div>
<div class="line">    ConnectionState::Connected     <span class="comment">// New value</span></div>
<div class="line">);</div>
<div class="ttc" id="anamespaceunilink_1_1base_html_a309474018616d324e14830540edab75ca03f4a47830f97377a35321051685071e"><div class="ttname"><a href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca03f4a47830f97377a35321051685071e">unilink::base::LinkState::Closed</a></div><div class="ttdeci">@ Closed</div></div>
<div class="ttc" id="anamespaceunilink_1_1base_html_a309474018616d324e14830540edab75ca2ec0d16e4ca169baedb9b2d50ec5c6d7"><div class="ttname"><a href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca2ec0d16e4ca169baedb9b2d50ec5c6d7">unilink::base::LinkState::Connected</a></div><div class="ttdeci">@ Connected</div></div>
<div class="ttc" id="anamespaceunilink_1_1base_html_a309474018616d324e14830540edab75ca902b0d55fddef6f8d651fe1035b7d4bd"><div class="ttname"><a href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75ca902b0d55fddef6f8d651fe1035b7d4bd">unilink::base::LinkState::Error</a></div><div class="ttdeci">@ Error</div></div>
<div class="ttc" id="anamespaceunilink_1_1base_html_a309474018616d324e14830540edab75cae321c53b354930ba96f0243e652df458"><div class="ttname"><a href="namespaceunilink_1_1base.html#a309474018616d324e14830540edab75cae321c53b354930ba96f0243e652df458">unilink::base::LinkState::Connecting</a></div><div class="ttdeci">@ Connecting</div></div>
<div class="ttc" id="athread__safe__state_8hpp_html"><div class="ttname"><a href="thread__safe__state_8hpp.html">thread_safe_state.hpp</a></div></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md32"></a>
AtomicState</h2>
<p>Lock-free atomic state operations:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="thread__safe__state_8hpp.html">unilink/concurrency/thread_safe_state.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">AtomicState&lt;int&gt; counter(0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Atomic increment (thread-safe)</span></div>
<div class="line">counter.fetch_add(1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Atomic compare-and-swap</span></div>
<div class="line"><span class="keywordtype">int</span> expected = 10;</div>
<div class="line"><span class="keywordtype">bool</span> success = counter.compare_exchange_strong(expected, 20);</div>
</div><!-- fragment --><p><b>Use when:</b></p>
<ul>
<li>High contention scenarios</li>
<li>Low latency required</li>
<li>Simple atomic types (int, bool, etc.)</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md34"></a>
ThreadSafeCounter</h2>
<p>Thread-safe counter with atomic operations:</p>
<div class="fragment"><div class="line">ThreadSafeCounter counter;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 1</span></div>
<div class="line">counter.increment();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 2</span></div>
<div class="line">counter.decrement();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 3</span></div>
<div class="line"><span class="keywordtype">size_t</span> value = counter.get();</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md36"></a>
ThreadSafeFlag</h2>
<p>Condition variable supported flags:</p>
<div class="fragment"><div class="line">ThreadSafeFlag ready_flag;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 1: Wait for flag</span></div>
<div class="line">ready_flag.wait();  <span class="comment">// Blocks until set</span></div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Ready!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 2: Set flag</span></div>
<div class="line">std::this_thread::sleep_for(std::chrono::seconds(1));</div>
<div class="line">ready_flag.set();  <span class="comment">// Unblocks waiting thread</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Thread 3: Check without blocking</span></div>
<div class="line"><span class="keywordflow">if</span> (ready_flag.is_set()) {</div>
<div class="line">    <span class="comment">// Flag is set</span></div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md38"></a>
Thread Safety Summary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Primitive   </th><th class="markdownTableHeadNone">Lock-Free   </th><th class="markdownTableHeadNone">Blocking   </th><th class="markdownTableHeadNone">Use Case    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ThreadSafeState</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Complex state management    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>AtomicState</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Simple atomic types    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ThreadSafeCounter</b>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Counters, statistics    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>ThreadSafeFlag</b>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">Synchronization, signals   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md40"></a>
Memory Tracking</h1>
<h2><a class="anchor" id="autotoc_md41"></a>
Built-in Memory Tracking</h2>
<p>Enable for debugging and development:</p>
<div class="fragment"><div class="line">cmake -S . -B build \</div>
<div class="line">  -DCMAKE_BUILD_TYPE=Debug \</div>
<div class="line">  -DUNILINK_ENABLE_MEMORY_TRACKING=ON</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md43"></a>
Features</h2>
<h3><a class="anchor" id="autotoc_md44"></a>
1. Allocation Tracking</h3>
<p>Monitor all memory allocations and deallocations:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="memory__tracker_8hpp.html">unilink/memory/memory_tracker.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceunilink_1_1common.html">unilink::common</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Tracking happens automatically</span></div>
<div class="line"><span class="keyword">auto</span>* data = <span class="keyword">new</span> uint8_t[1024];  <span class="comment">// Tracked</span></div>
<div class="line"><span class="keyword">delete</span>[] data;  <span class="comment">// Tracked</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Query statistics</span></div>
<div class="line">MemoryTracker::Stats stats = MemoryTracker::instance().get_stats();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Total allocations: &quot;</span> &lt;&lt; stats.total_allocations &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Total deallocations: &quot;</span> &lt;&lt; stats.total_deallocations &lt;&lt; std::endl;</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Current usage: &quot;</span> &lt;&lt; stats.current_usage &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md46"></a>
2. Leak Detection</h3>
<p>Identify potential memory leaks:</p>
<div class="fragment"><div class="line"><span class="comment">// At program exit, check for leaks</span></div>
<div class="line">MemoryTracker::Stats stats = MemoryTracker::instance().get_stats();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (stats.total_allocations != stats.total_deallocations) {</div>
<div class="line">    <span class="keywordtype">size_t</span> leaked = stats.total_allocations - stats.total_deallocations;</div>
<div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;⚠️ Memory leak detected: &quot;</span></div>
<div class="line">              &lt;&lt; leaked &lt;&lt; <span class="stringliteral">&quot; allocations not freed&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get detailed report</span></div>
<div class="line">    MemoryTracker::instance().print_report();</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Output example:</b></p>
<div class="fragment"><div class="line">=== Memory Tracking Report ===</div>
<div class="line">Total allocations: 1250</div>
<div class="line">Total deallocations: 1248</div>
<div class="line">Leaked allocations: 2</div>
<div class="line">Current memory usage: 2048 bytes</div>
<div class="line">Peak memory usage: 4096 bytes</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md48"></a>
3. Performance Monitoring</h3>
<p>Track memory usage patterns:</p>
<div class="fragment"><div class="line"><span class="comment">// Track peak memory usage</span></div>
<div class="line"><span class="keywordtype">size_t</span> peak = MemoryTracker::instance().get_peak_usage();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Peak memory: &quot;</span> &lt;&lt; peak &lt;&lt; <span class="stringliteral">&quot; bytes&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Track allocation count</span></div>
<div class="line"><span class="keywordtype">size_t</span> alloc_count = MemoryTracker::instance().get_allocation_count();</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Allocations: &quot;</span> &lt;&lt; alloc_count &lt;&lt; std::endl;</div>
</div><!-- fragment --><hr  />
<h3><a class="anchor" id="autotoc_md50"></a>
4. Debug Reports</h3>
<p>Detailed memory usage reports:</p>
<div class="fragment"><div class="line"><span class="comment">// Print detailed report to stdout</span></div>
<div class="line">MemoryTracker::instance().print_report();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Or get as string</span></div>
<div class="line">std::string report = MemoryTracker::instance().get_report_string();</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md52"></a>
Zero Overhead in Release</h2>
<p>Memory tracking has <b>zero overhead</b> in Release builds:</p>
<div class="fragment"><div class="line"><span class="comment">// In Release builds (UNILINK_ENABLE_MEMORY_TRACKING=OFF):</span></div>
<div class="line"><span class="comment">// All tracking calls are compiled out</span></div>
<div class="line"><span class="comment">// No runtime overhead</span></div>
<div class="line"><span class="comment">// No memory overhead</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md54"></a>
AddressSanitizer Support</h1>
<h2><a class="anchor" id="autotoc_md55"></a>
Enable AddressSanitizer</h2>
<div class="fragment"><div class="line">cmake -S . -B build \</div>
<div class="line">  -DCMAKE_BUILD_TYPE=Debug \</div>
<div class="line">  -DUNILINK_ENABLE_SANITIZERS=ON</div>
<div class="line"> </div>
<div class="line">cmake --build build -j</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md57"></a>
What ASan Detects</h2>
<p>AddressSanitizer detects:</p>
<ul>
<li>✅ <b>Use-after-free</b></li>
<li>✅ <b>Heap buffer overflow</b></li>
<li>✅ <b>Stack buffer overflow</b></li>
<li>✅ <b>Use-after-return</b></li>
<li>✅ <b>Memory leaks</b></li>
<li>✅ <b>Double-free</b></li>
<li>✅ <b>Invalid free</b></li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md59"></a>
Running with ASan</h2>
<div class="fragment"><div class="line"># Run application</div>
<div class="line">./my_app</div>
<div class="line"> </div>
<div class="line"># Run tests</div>
<div class="line">cd build</div>
<div class="line">ctest --output-on-failure</div>
</div><!-- fragment --><p><b>ASan output example:</b></p>
<div class="fragment"><div class="line">=================================================================</div>
<div class="line">==12345==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000050</div>
<div class="line">WRITE of size 4 at 0x602000000050 thread T0</div>
<div class="line">    #0 0x7f8a4b5c6d42 in main</div>
<div class="line">    #1 0x7f8a4b3c7082 in __libc_start_main</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md61"></a>
Performance Impact</h2>
<ul>
<li><b>Runtime overhead:</b> ~2-3x slowdown</li>
<li><b>Memory overhead:</b> ~2x memory usage</li>
<li><b>Only for testing</b> - not for production</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md63"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md64"></a>
1. Buffer Management</h2>
<h3><a class="anchor" id="autotoc_md65"></a>
✅ DO</h3>
<div class="fragment"><div class="line"><span class="comment">// Use SafeDataBuffer to wrap existing data</span></div>
<div class="line">std::vector&lt;uint8_t&gt; raw(data, data + len);</div>
<div class="line">SafeDataBuffer buffer(raw);</div>
<div class="line">process_buffer(buffer);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use safe_span for views</span></div>
<div class="line"><span class="keywordtype">void</span> process(safe_span&lt;const uint8_t&gt; data) {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md66"></a>
❌ DON'T</h3>
<div class="fragment"><div class="line"><span class="comment">// Avoid raw pointers without bounds checking</span></div>
<div class="line">uint8_t* buf = <span class="keyword">new</span> uint8_t[size];</div>
<div class="line">memcpy(buf, data, len);  <span class="comment">// No bounds check!</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Avoid pointer arithmetic without validation</span></div>
<div class="line">uint8_t* ptr = buffer + offset;  <span class="comment">// May go out of bounds</span></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md68"></a>
2. Type Conversions</h2>
<h3><a class="anchor" id="autotoc_md69"></a>
✅ DO</h3>
<div class="fragment"><div class="line"><span class="comment">// Use safe conversion utilities</span></div>
<div class="line">std::string str = <a class="code" href="namespaceunilink_1_1base_1_1safe__convert.html#a3c41d9c6266428458c97891710ac2f0d">safe_convert::uint8_to_string</a>(data, size);</div>
<div class="line"><span class="keyword">const</span> uint8_t* bytes = <a class="code" href="namespaceunilink_1_1base_1_1safe__convert.html#a439f562cc86e942edf24d1408bcb8a92">safe_convert::string_to_uint8</a>(str);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md70"></a>
❌ DON'T</h3>
<div class="fragment"><div class="line"><span class="comment">// Avoid unsafe casts</span></div>
<div class="line">std::string str = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(data);  <span class="comment">// May not be null-terminated</span></div>
<div class="line">uint8_t* bytes = <span class="keyword">const_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(str.data());  <span class="comment">// Removes const incorrectly</span></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md72"></a>
3. Thread Safety</h2>
<h3><a class="anchor" id="autotoc_md73"></a>
✅ DO</h3>
<div class="fragment"><div class="line"><span class="comment">// Use thread-safe primitives</span></div>
<div class="line">ThreadSafeState&lt;State&gt; state;</div>
<div class="line">ThreadSafeCounter counter;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Let unilink handle synchronization</span></div>
<div class="line">client-&gt;send(data);  <span class="comment">// Already thread-safe</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md74"></a>
❌ DON'T</h3>
<div class="fragment"><div class="line"><span class="comment">// Avoid manual locking of unilink internals</span></div>
<div class="line"><span class="comment">// std::lock_guard&lt;std::mutex&gt; lock(internal_mutex);  // DON&#39;T DO THIS</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Avoid shared state without synchronization</span></div>
<div class="line"><span class="comment">// state = NewState;  // Race condition!</span></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md76"></a>
4. Memory Tracking</h2>
<h3><a class="anchor" id="autotoc_md77"></a>
✅ DO</h3>
<div class="fragment"><div class="line"><span class="comment">// Enable in Debug builds</span></div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DUNILINK_ENABLE_MEMORY_TRACKING=ON</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check for leaks at exit</span></div>
<div class="line"><span class="keyword">auto</span> stats = MemoryTracker::instance().get_stats();</div>
<div class="line">assert(stats.total_allocations == stats.total_deallocations);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md78"></a>
❌ DON'T</h3>
<div class="fragment"><div class="line"><span class="comment">// Don&#39;t enable in Release builds (performance)</span></div>
<div class="line"><span class="comment">// cmake -DCMAKE_BUILD_TYPE=Release -DUNILINK_ENABLE_MEMORY_TRACKING=ON</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Don&#39;t ignore leak reports</span></div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md80"></a>
5. Sanitizers</h2>
<h3><a class="anchor" id="autotoc_md81"></a>
✅ DO</h3>
<div class="fragment"><div class="line"><span class="comment">// Use during development and testing</span></div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -DUNILINK_ENABLE_SANITIZERS=ON</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Run full test suite with sanitizers</span></div>
<div class="line">ctest --output-on-failure</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fix all reported issues</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md82"></a>
❌ DON'T</h3>
<div class="fragment"><div class="line"><span class="comment">// Never deploy with sanitizers enabled</span></div>
<div class="line"><span class="comment">// (2-3x performance penalty)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Don&#39;t suppress sanitizer warnings without investigation</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md84"></a>
Memory Safety Benefits</h1>
<h2><a class="anchor" id="autotoc_md85"></a>
Prevents Common Vulnerabilities</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Vulnerability   </th><th class="markdownTableHeadNone">Traditional C++   </th><th class="markdownTableHeadNone">unilink    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Buffer Overflow</b>   </td><td class="markdownTableBodyNone">Possible   </td><td class="markdownTableBodyNone">Prevented (bounds checked)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Use-After-Free</b>   </td><td class="markdownTableBodyNone">Possible   </td><td class="markdownTableBodyNone">Detected (ASan)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Memory Leak</b>   </td><td class="markdownTableBodyNone">Possible   </td><td class="markdownTableBodyNone">Detected (tracking)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Data Race</b>   </td><td class="markdownTableBodyNone">Possible   </td><td class="markdownTableBodyNone">Prevented (thread-safe)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Type Confusion</b>   </td><td class="markdownTableBodyNone">Possible   </td><td class="markdownTableBodyNone">Prevented (type-safe)   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="autotoc_md87"></a>
Performance</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Feature   </th><th class="markdownTableHeadNone">Debug Overhead   </th><th class="markdownTableHeadNone">Release Overhead    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Bounds Checking</b>   </td><td class="markdownTableBodyNone">~5%   </td><td class="markdownTableBodyNone">&lt;1%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Memory Tracking</b>   </td><td class="markdownTableBodyNone">~10%   </td><td class="markdownTableBodyNone">0% (disabled)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Thread Safety</b>   </td><td class="markdownTableBodyNone">~5%   </td><td class="markdownTableBodyNone">~2-5%    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Memory Pools</b>   </td><td class="markdownTableBodyNone">0%   </td><td class="markdownTableBodyNone">Negative (faster!)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>AddressSanitizer</b>   </td><td class="markdownTableBodyNone">~200-300%   </td><td class="markdownTableBodyNone">N/A (not used)   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md89"></a>
Testing Memory Safety</h1>
<h2><a class="anchor" id="autotoc_md90"></a>
Unit Tests</h2>
<div class="fragment"><div class="line"># Run memory safety tests</div>
<div class="line">./build/test/run_memory_safety_tests</div>
</div><!-- fragment --><p><b>Tests cover:</b></p>
<ul>
<li>Buffer bounds checking</li>
<li>Memory leak detection</li>
<li>Safe type conversions</li>
<li>Thread safety</li>
<li>Memory pool correctness</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md92"></a>
Integration Tests</h2>
<div class="fragment"><div class="line"># Run with AddressSanitizer</div>
<div class="line">cmake -S . -B build -DUNILINK_ENABLE_SANITIZERS=ON</div>
<div class="line">cmake --build build</div>
<div class="line">cd build &amp;&amp; ctest</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md94"></a>
Continuous Integration</h2>
<p>All memory safety features are tested in CI/CD:</p>
<ul>
<li>✅ Memory tracking enabled</li>
<li>✅ AddressSanitizer enabled</li>
<li>✅ ThreadSanitizer enabled (selected tests)</li>
<li>✅ Valgrind memcheck</li>
</ul>
<p>See ../guides/testing.md "Testing Guide" for details.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md96"></a>
Next Steps</h1>
<ul>
<li><a class="el" href="md_docs_architecture_runtime_behavior.html">Runtime Behavior</a> - Threading and execution model</li>
<li><a class="el" href="/home/runner/work/unilink/unilink/README.md#md_README">System Overview</a> - High-level architecture</li>
<li>../guides/testing.md "Testing Guide" - Memory safety testing</li>
<li>../guides/best_practices.md "Best Practices" - Safe coding patterns </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Feb 5 2026 11:03:49 for unilink by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
